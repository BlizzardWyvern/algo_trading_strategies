"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Contracts = void 0;
/*

    Copyright 2019 dYdX Trading Inc.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

*/
const bignumber_js_1 = __importDefault(require("bignumber.js"));
const lodash_1 = __importDefault(require("lodash"));
const fact_registry_abi_json_1 = __importDefault(require("../contracts/fact-registry-abi.json"));
const mintable_token_abi_json_1 = __importDefault(require("../contracts/mintable-token-abi.json"));
const proxy_deposit_abi_json_1 = __importDefault(require("../contracts/proxy-deposit-abi.json"));
const starkware_perpetual_abi_json_1 = __importDefault(require("../contracts/starkware-perpetual-abi.json"));
const usdc_abi_json_1 = __importDefault(require("../contracts/usdc-abi.json"));
// Contracts
const types_1 = require("../types");
var OUTCOMES;
(function (OUTCOMES) {
    OUTCOMES[OUTCOMES["INITIAL"] = 0] = "INITIAL";
    OUTCOMES[OUTCOMES["RESOLVED"] = 1] = "RESOLVED";
    OUTCOMES[OUTCOMES["REJECTED"] = 2] = "REJECTED";
})(OUTCOMES || (OUTCOMES = {}));
class Contracts {
    constructor(provider, networkId, web3, sendOptions = {}) {
        this.contractsList = [];
        this.web3 = web3;
        this.defaultOptions = {
            gas: null,
            gasPrice: undefined,
            value: 0,
            from: null,
            confirmations: 0,
            confirmationType: types_1.ConfirmationType.Confirmed,
            gasMultiplier: 1.5,
            ...sendOptions,
        };
        this.networkId = networkId;
        // Contracts
        this.factRegistry = this.addContract(fact_registry_abi_json_1.default);
        this.starkwarePerpetual = this.addContract(starkware_perpetual_abi_json_1.default);
        this.collateralToken = this.addContract(usdc_abi_json_1.default);
        this.mintableToken = this.addContract(mintable_token_abi_json_1.default);
        this.proxyDepositContract = this.addContract(proxy_deposit_abi_json_1.default);
        this.setProvider(provider, networkId);
        this.setDefaultAccount(this.web3.eth.defaultAccount);
    }
    setProvider(provider, networkId) {
        this.networkId = networkId;
        this.contractsList.forEach((contract) => this.setContractProvider(contract.contract, contract.json, provider, networkId));
    }
    setDefaultAccount(account) {
        this.contractsList.forEach((contract) => {
            contract.contract.options.from = account;
        });
    }
    async call(method, specificOptions = {}) {
        const { blockNumber, ...otherOptions } = this.toCallOptions({
            ...this.defaultOptions,
            ...specificOptions,
        });
        return method.call(otherOptions, blockNumber || 'latest');
    }
    async send(contract, method, specificOptions = {}) {
        const sendOptions = {
            ...this.defaultOptions,
            ...specificOptions,
        };
        const result = await this._send(contract, method, sendOptions);
        return result;
    }
    // ============ Helper Functions ============
    addContract(json, isTest = false) {
        const contract = new this.web3.eth.Contract(json.abi);
        this.contractsList.push({ contract, json, isTest });
        return contract;
    }
    setContractProvider(contract, contractJson, provider, networkId) {
        contract.setProvider(provider);
        // Use market-specific info if available, and fall back to non-market-specific info.
        const deployedInfo = contractJson.networks[networkId];
        contract.options.address = deployedInfo && deployedInfo.address;
    }
    async _send(// tslint:disable-line:function-name
    contract, method, sendOptions = {}) {
        const { confirmations, confirmationType, gasMultiplier, ...txOptions } = sendOptions;
        if (confirmationType && !Object.values(types_1.ConfirmationType).includes(confirmationType)) {
            throw new Error(`Invalid confirmation type: ${confirmationType}`);
        }
        if (confirmationType === types_1.ConfirmationType.Simulate || !txOptions.gas) {
            const gasEstimate = await this.estimateGas(method, txOptions);
            txOptions.gas = Math.floor(gasEstimate * gasMultiplier);
            if (confirmationType === types_1.ConfirmationType.Simulate) {
                return {
                    gasEstimate,
                    gas: txOptions.gas,
                };
            }
        }
        let hashOutcome = OUTCOMES.INITIAL;
        let confirmationOutcome = OUTCOMES.INITIAL;
        if (confirmationType === types_1.ConfirmationType.Sender) {
            const data = method.encodeABI();
            const from = txOptions.from || this.web3.defaultAccount;
            if (from === null) {
                throw new Error('Cannot sendTransaction with from=null');
            }
            if (lodash_1.default.isNil(txOptions.nonce)) {
                throw new Error('Cannot sendTransaction with nonce=null');
            }
            const nonceIsHexString = (typeof txOptions.nonce === 'string') &&
                txOptions.nonce.includes('0x');
            const nonceBn = new bignumber_js_1.default(txOptions.nonce, nonceIsHexString ? 16 : 10);
            const stPromi = this.web3.eth.sendTransaction({
                gas: txOptions.gas,
                value: txOptions.value,
                gasPrice: txOptions.gasPrice,
                to: contract.options.address,
                from,
                nonce: nonceBn.toNumber(),
                data,
            });
            const stPromise = new Promise((resolve, reject) => {
                stPromi.on('error', (error) => {
                    if (hashOutcome === OUTCOMES.INITIAL) {
                        hashOutcome = OUTCOMES.REJECTED;
                        reject(error);
                        stPromi.off();
                    }
                });
                stPromi.on('transactionHash', (txHash) => {
                    if (hashOutcome === OUTCOMES.INITIAL) {
                        hashOutcome = OUTCOMES.RESOLVED;
                        resolve(txHash);
                        stPromi.off();
                    }
                });
            });
            const stResult = await stPromise;
            return this.normalizeResponse({ transactionHash: stResult });
        }
        const promi = method.send(this.toNativeSendOptions(txOptions));
        let transactionHash;
        let hashPromise;
        let confirmationPromise;
        if (confirmationType && [
            types_1.ConfirmationType.Hash,
            types_1.ConfirmationType.Both,
        ].includes(confirmationType)) {
            hashPromise = new Promise((resolve, reject) => {
                promi.on('error', (error) => {
                    if (hashOutcome === OUTCOMES.INITIAL) {
                        hashOutcome = OUTCOMES.REJECTED;
                        reject(error);
                        promi.off();
                    }
                });
                promi.on('transactionHash', (txHash) => {
                    if (hashOutcome === OUTCOMES.INITIAL) {
                        hashOutcome = OUTCOMES.RESOLVED;
                        resolve(txHash);
                        if (confirmationType !== types_1.ConfirmationType.Both) {
                            promi.off();
                        }
                    }
                });
            });
            transactionHash = await hashPromise;
        }
        if (confirmationType && [
            types_1.ConfirmationType.Confirmed,
            types_1.ConfirmationType.Both,
        ].includes(confirmationType)) {
            confirmationPromise = new Promise((resolve, reject) => {
                promi.on('error', (error) => {
                    if (confirmationOutcome === OUTCOMES.INITIAL &&
                        (confirmationType === types_1.ConfirmationType.Confirmed ||
                            hashOutcome === OUTCOMES.RESOLVED)) {
                        confirmationOutcome = OUTCOMES.REJECTED;
                        reject(error);
                        promi.off();
                    }
                });
                if (confirmations) {
                    promi.on('confirmation', (confNumber, receipt) => {
                        if (confNumber >= confirmations) {
                            if (confirmationOutcome === OUTCOMES.INITIAL) {
                                confirmationOutcome = OUTCOMES.RESOLVED;
                                resolve(receipt);
                                promi.off();
                            }
                        }
                    });
                }
                else {
                    promi.on('receipt', (receipt) => {
                        confirmationOutcome = OUTCOMES.RESOLVED;
                        resolve(receipt);
                        promi.off();
                    });
                }
            });
        }
        if (confirmationType === types_1.ConfirmationType.Hash) {
            return this.normalizeResponse({ transactionHash });
        }
        if (confirmationType === types_1.ConfirmationType.Confirmed) {
            return confirmationPromise;
        }
        return this.normalizeResponse({
            transactionHash,
            confirmation: confirmationPromise,
        });
    }
    async estimateGas(method, txOptions) {
        const estimateOptions = this.toEstimateOptions(txOptions);
        try {
            const gasEstimate = await method.estimateGas(estimateOptions);
            return gasEstimate;
        }
        catch (error) {
            error.transactionData = {
                ...estimateOptions,
                data: method.encodeABI(),
                to: method._parent._address,
            };
            throw error;
        }
    }
    // ============ Parse Options ============
    toEstimateOptions(options) {
        return lodash_1.default.pick(options, [
            'from',
            'value',
        ]);
    }
    toCallOptions(options) {
        return lodash_1.default.pick(options, [
            'from',
            'value',
            'blockNumber',
        ]);
    }
    toNativeSendOptions(options) {
        return lodash_1.default.pick(options, [
            'from',
            'value',
            'gasPrice',
            'gas',
            'nonce',
        ]);
    }
    normalizeResponse(txResult) {
        const txHash = txResult.transactionHash;
        if (txHash) {
            const { transactionHash: internalHash, nonce: internalNonce, } = txHash;
            if (internalHash) {
                txResult.transactionHash = internalHash;
            }
            if (internalNonce) {
                txResult.nonce = internalNonce;
            }
        }
        return txResult;
    }
}
exports.Contracts = Contracts;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29udHJhY3RzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9Db250cmFjdHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7RUFnQkU7QUFDRixnRUFBcUM7QUFDckMsb0RBQXVCO0FBYXZCLGlHQUFrRTtBQUNsRSxtR0FBb0U7QUFDcEUsaUdBQWtFO0FBQ2xFLDZHQUE4RTtBQUM5RSwrRUFBaUQ7QUFDakQsWUFBWTtBQUNaLG9DQVFrQjtBQUVsQixJQUFLLFFBSUo7QUFKRCxXQUFLLFFBQVE7SUFDWCw2Q0FBVyxDQUFBO0lBQ1gsK0NBQVksQ0FBQTtJQUNaLCtDQUFZLENBQUE7QUFDZCxDQUFDLEVBSkksUUFBUSxLQUFSLFFBQVEsUUFJWjtBQWFELE1BQWEsU0FBUztJQVlwQixZQUNFLFFBQWtCLEVBQ2xCLFNBQWlCLEVBQ2pCLElBQVUsRUFDVixjQUEyQixFQUFFO1FBWHhCLGtCQUFhLEdBQW1CLEVBQUUsQ0FBQztRQWF4QyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsY0FBYyxHQUFHO1lBQ3BCLEdBQUcsRUFBRSxJQUFJO1lBQ1QsUUFBUSxFQUFFLFNBQVM7WUFDbkIsS0FBSyxFQUFFLENBQUM7WUFDUixJQUFJLEVBQUUsSUFBSTtZQUNWLGFBQWEsRUFBRSxDQUFDO1lBQ2hCLGdCQUFnQixFQUFFLHdCQUFnQixDQUFDLFNBQVM7WUFDNUMsYUFBYSxFQUFFLEdBQUc7WUFDbEIsR0FBRyxXQUFXO1NBQ2YsQ0FBQztRQUVGLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBRTNCLFlBQVk7UUFDWixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsZ0NBQWUsQ0FBQyxDQUFDO1FBQ3RELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLHNDQUFxQixDQUFDLENBQUM7UUFDbEUs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